!function(){function e(e){Et.emit("login",e)}function t(e,t,o){R(),Et.emit("create_room",{room_title:e,game_type:t,room_size:o})}function o(){var e=document.getElementById("room_list");e.innerHTML="";for(var t=0;t<yt.roomList.length;++t){var o=document.createElement("div");o.className="room_item",o.innerHTML="<div class='room_header_wrapper'><div class='room_id'>"+yt.roomList[t].id+"</div><div class='room_title'>"+yt.roomList[t].title+"</div><div style='clear:both;'></div></div><div class='room_type'><i>Type</i>: <b>"+yt.roomList[t].gameType+"</b></div><div class='room_size'><i>Size</i>: <b>"+yt.roomList[t].roomSize+"</b></div>",e.appendChild(o),o.onclick=function(e){return function(){i(yt.roomList[e].id)}}(t)}var n=document.createElement("div");n.style.setProperty("clear","both"),e.appendChild(n)}function i(e){R(),Et.emit("join_room",e)}function n(){d(" **starting game** "),Et.emit("start_game")}function r(){var e=Math.floor(Math.random()*yt.terrainChoices.length);return e==yt.terrainChoices.length&&e--,yt.terrainChoices[e]}function l(e){var t=yt.currentRoom.hashed_member[e].player;gt.viewOffset[0]=-t.x+gt.display.width/2,gt.viewOffset[1]=-t.y+gt.display.height/2}function a(){gt.viewMode.LOCKED_PLAYER_VIEW_MODE=!0,yt.turnEnded=!1,gt.endOfTurnDelay=Rt.END_OF_TURN_DELAY,gt.player[Rt.MAIN_PLAYER].command.USE_ITEM={use:!1},gt.player[Rt.MAIN_PLAYER].usedItem=!1,gt.hasMoved=!1,gt.turnStartTime=Date.now(),gt.timePenalty=0,gt.usedItem=!1,gt.countdown=setInterval(function(){if(gt.hasMoved)return void clearInterval(gt.countdown);var e=Date.now();e-gt.turnStartTime<2e4?(gt.timePenalty=Math.floor(Math.floor(e-gt.turnStartTime)/1e3),document.getElementById("clock").innerHTML=Math.floor(21-(e-gt.turnStartTime)/1e3)):(gt.hasMoved=!0,gt.player[Rt.MAIN_PLAYER].thrust=0,gt.player[Rt.MAIN_PLAYER].command={},gt.timePenalty=20,clearInterval(gt.countdown))},1e3/30)}function s(){gt.isGamePlaying&&(yt.turnEnded||(console.log("my end_of_turn"),yt.turnEnded=!0,Et.emit("end_of_turn",{time_penalty:gt.timePenalty,x:gt.player[Rt.MAIN_PLAYER].x,y:gt.player[Rt.MAIN_PLAYER].y,v:gt.player[Rt.MAIN_PLAYER].v,dir:gt.player[Rt.MAIN_PLAYER].dir,angle:gt.player[Rt.MAIN_PLAYER].angle,orientation:gt.player[Rt.MAIN_PLAYER].orientation,hp:gt.player[Rt.MAIN_PLAYER].hp})))}function T(){yt.deathAnnounced||(yt.deathAnnounced=!0,Et.emit("player_death"))}function h(e){for(var t=[],o=0;o<yt.currentRoom.member.length;++o)yt.currentRoom.member[o].id!=e&&t.push(yt.currentRoom.member[o]);yt.currentRoom.member=t,delete yt.currentRoom.hashed_member[e]}function m(e){gt.messageQueue.push({id:-1,name:"NEXTSTEP",msg:e}),u()}function d(e){var t=Date.now();if(t-gt.lastMessageTime<Rt.MESSAGE_FLOOD_LIMIT)return void gt.messageQueue.push({id:-1,name:"SYSTEM",msg:"MESSAGE FLOODING"});var o=e.trim();""!=o&&(gt.lastMessageTime=t,gt.messageQueue.push({id:yt.userid,name:yt.username,msg:o}),Et.emit("message",o),gt.isGamePlaying&&gt.player[Rt.MAIN_PLAYER].setShoutout(e),u(),L())}function u(){for(var e="",t=Math.max(0,gt.messageQueue.length-Rt.MAX_MESSAGE_DISPLAY);t<gt.messageQueue.length;++t)e+="<div style='background-color:rgba(0,0,0,0.6);color:white'><b><i>"+gt.messageQueue[t].name+"</i></b>: <span style='font-weight:lighter'>"+gt.messageQueue[t].msg+"</span><br/></div>";document.getElementById("message_display").innerHTML=e}function c(){function t(){var t=o.value.trim();return""==t?(o.style.setProperty("border","3px solid red"),void o.focus()):(e(t),void document.getElementById("login_layer").style.setProperty("display","none"))}var o=document.getElementById("login_input");o.focus(),document.getElementById("login_start_button").addEventListener("click",function(){t()}),document.getElementById("login_input").addEventListener("keydown",function(e){return 13==e.which?(t(),e.preventDefault(),!1):this.value.length>20&&8!=e.which?(e.preventDefault(),!1):void 0})}function _(){Et.emit("exit_room"),yt.currentRoom=null}function f(){var e={gameType:"squirmish",roomSize:2},o=document.getElementById("room_title_input");document.getElementById("create_room").addEventListener("click",function(){document.getElementById("create_room_form").style.setProperty("display","block"),o.focus()}),document.getElementById("create_room_cancel").addEventListener("click",function(){document.getElementById("create_room_form").style.setProperty("display","none"),o.blur()}),document.getElementById("create_room_submit").addEventListener("click",function(){var i=o.value.trim();return""==i?(o.style.border="5px solid yellow",void o.focus()):(o.style.border="none",o.value="",t(i.substring(0,40),e.gameType,e.roomSize),void document.getElementById("create_room_form").style.setProperty("display","none"))});for(var i=[[{name:"room_game_squirmish",value:"squirmish"},{name:"room_game_team",value:"team"}],[{name:"room_size_2",value:2},{name:"room_size_4",value:4},{name:"room_size_6",value:6},{name:"room_size_8",value:8}]],n=0;n<i.length;++n)for(var r=0;r<i[n].length;++r)document.getElementById(i[n][r].name).storedValue=i[n][r].value,document.getElementById(i[n][r].name).group=i[n],document.getElementById(i[n][r].name).lobbyScreenState=e,document.getElementById(i[n][r].name).addEventListener("click",function(){for(var e=0;e<this.group.length;++e)document.getElementById(this.group[e].name).className="";this.className="chosen","team"==this.storedValue||"squirmish"==this.storedValue?this.lobbyScreenState.gameType=this.storedValue:this.lobbyScreenState.roomSize=this.storedValue})}function E(){clearInterval(gt.countdown);for(var e=0;e<yt.currentRoom.member.length;++e)yt.currentRoom.member.currentSnapshot&&(yt.currentRoom.member.currentSnapshot.obsolete=!0);gt.isGamePlaying=!1,yt.currentRoom.status="ready";var t=document.getElementById("result_notif_box"),o=document.getElementById("result_label");"win"==gt.gameResult?(t.style.setProperty("background-color","rgba(21,211,131,0.8)"),o.innerHTML="team"==yt.currentRoom.gameType?"Your Team WON!":"You WON!"):(t.style.setProperty("background-color","rgba(211,31,31,0.8)"),o.innerHTML="team"==yt.currentRoom.gameType?"Your Team Lost.":"You Lost."),t.style.display="block"}function y(){document.getElementById("room_start_game_button").addEventListener("click",function(){yt.currentRoom.starting||(yt.currentRoom.starting=!0,document.getElementById("room_start_game_button").innerHTML="Starting...",document.getElementById("room_start_game_button").style.cursor="default",n())}),document.getElementById("room_swap_team_button").addEventListener("click",function(){g()}),document.getElementById("waiting_room_chat_input").addEventListener("keydown",function(e){return 13==e.which?(d(document.getElementById("waiting_room_chat_input").value),document.getElementById("waiting_room_chat_input").value="",e.stopPropagation(),!1):document.getElementById("waiting_room_chat_input").value.length<100||8==e.which?void 0:(e.preventDefault(),!1)}),document.getElementById("result_confirmation_button").addEventListener("click",function(){document.getElementById("result_notif_box").style.display="none",R(),A()}),document.getElementById("room_exit_room_button").addEventListener("click",function(){_(),I()})}function g(){var e="A"==yt.currentRoom.hashed_member[yt.userid].team?"B":"A";Et.emit("join_team",e)}function R(){if(document.getElementById("room_layer").style.display="block",document.getElementById("lobby_layer").style.display="none",document.getElementById("room_loading").style.display="block",document.getElementById("waiting_room_chat_input").focus(),yt.currentRoom){for(var e=0;e<yt.currentRoom.exitedMember.length;++e)h(yt.currentRoom.exitedMember[e]);yt.currentRoom.exitedMember=[]}p()}function p(){clearInterval(gt.timer),yt.turnEnded=!1,yt.deathAnnounced=!1,yt.snapshotBlocked=!1,gt.player=[],gt.viewMode={},gt.viewOffset=[0,0],gt.terrainOffset=[250,0],gt.powerBar={power:0,marker:0},gt.bullets=[],gt.explosions=[],gt.effects=[],gt.wind={angle:-90,strength:0,bufferedCaption:ht("0",50,"white",2,"black")},gt.terrainBitsName=null,gt.snapshotDelta=200,gt.usedItem=!1,gt.currentTurn=-1,gt.hasMoved=!0,gt.countdown=null,gt.turnStartTime=0,gt.requestToStartCurrentTurn=!1,gt.timePenalty=0,gt.startDelay=200,gt.listenerRegistered=!1,gt.chatFocused=!1,gt.messageQueue=[],gt.lastMessageTime=0,gt.isGamePlaying=!1,gt.backgroundColor="white",gt.terrainAssetName="crepes",gt.terrainBitsName="green_terrain_bits",gt.initialized=!1}function A(){if(yt.currentRoom){document.getElementById("room_loading").style.display="none";for(var e="",t=0;t<yt.currentRoom.member.length;++t){var o=yt.currentRoom.member[t];e+='<div class="room_member_list_item"',o.team&&"B"==o.team&&(e+='style="background-color:rgba(40,211,34,0.5)"'),e+='><div class="room_member_username">',e+="<b>"+o.name+"</b>",yt.currentRoom.owner==o.id&&(e+=" [Room Owner]"),e+='</div><div class="room_member_team">',o.team&&(e+="<b>Team "+o.team+"</b>"),e+='</div><div style="clear:both"></div></div>'}document.getElementById("room_member_list").innerHTML=e,document.getElementById("room_title_info").innerHTML="["+yt.currentRoom.roomId+"] "+yt.currentRoom.roomTitle,document.getElementById("game_type_info").innerHTML="Game Type: "+yt.currentRoom.gameType,document.getElementById("room_size_info").innerHTML="Size: "+yt.currentRoom.member.length+"/"+yt.currentRoom.roomSize,document.getElementById("room_start_game_button").style.display=yt.currentRoom.owner!=yt.userid?"none":"block",document.getElementById("room_swap_team_button").style.display="team"==yt.currentRoom.gameType?"block":"none"}}function I(){yt.currentRoom=null,document.getElementById("lobby_layer").style.display="block",document.getElementById("room_layer").style.display="none"}function L(){for(var e="",t=Math.max(0,gt.messageQueue.length-Rt.MAX_MESSAGE_DISPLAY);t<gt.messageQueue.length;++t)e+="<div style='color:black'><b><i><span style='color:brown'>"+gt.messageQueue[t].name+"</span></i></b>: <span style='font-weight:lighter'>"+gt.messageQueue[t].msg+"</span><br/></div>";var o=document.getElementById("waiting_room_chat_display");o.innerHTML=e,o.scrollTop=o.scrollHeight}function v(e,t,o,i){this.ANGLE_LOWER_LIMIT=Rt.ANGLE_LOWER_LIMIT,this.ANGLE_UPPER_LIMIT=Rt.ANGLE_UPPER_LIMIT,this.PLAYER_WIDTH=Rt.PLAYER_WIDTH,this.PLAYER_HEIGHT=Rt.PLAYER_HEIGHT,this.BARREL_WIDTH=Rt.BARREL_WIDTH,this.BARREL_HEIGHT=Rt.BARREL_HEIGHT,this.BARREL_COLOR=Rt.BARREL_COLOR,this.MAX_BULLET_THRUST=Rt.MAX_BULLET_THRUST,this.MAX_HEALTH_POINT=1700,this.PLAYER_VERTICAL_MOVEMENT_LIMIT=Rt.PLAYER_VERTICAL_MOVEMENT_LIMIT,this.name=i,this.x=e,this.y=t,this.v=0,this.color=o,this.thrust=0,this.dir=[1,0],this.hp=this.MAX_HEALTH_POINT,this.angle=45,this.orientation=1,this.command={},this.power=0,this.isAlive=!0,this.renderable=!0,this.shoutoutDelta=0,this.itemSlot=["dual","power","health"],this.damagedDelta=0,this.bufferCaption()}function b(e,t,o){this.x=e,this.y=t,this.v=o,this.isAlive=!0,this.EXPLOSION_RADIUS=Rt.EXPLOSION_RADIUS,this.GRAVITY=Rt.GRAVITY,this.WIND_STRENGTH_CALLIBRATOR=Rt.WIND_STRENGTH_CALLIBRATOR,this.BULLET_RADIUS=Rt.BULLET_RADIUS,this.EXPLOSION_DAMAGE=500,this.aliveTime=0}function P(e,t,o){b.call(this,e,t,o),this.BULLET_RADIUS+=4,this.EXPLOSION_DAMAGE+=800}function O(){gt.display=document.getElementById("display"),gt.display.width=window.innerWidth,gt.display.height=window.innerHeight,gt.g=display.getContext("2d")}function M(){gt.terrainBuffer=pt.get(gt.terrainAssetName),gt.terrainData=gt.terrainBuffer.getContext("2d").getImageData(0,0,gt.terrainBuffer.width,gt.terrainBuffer.height)}function w(){M()}function S(){gt.isGamePlaying=!0,yt.currentRoom.status="playing",w(),gt.viewMode.LOCKED_PLAYER_VIEW_MODE=!0,yt.listenerRegistered||(D(),yt.listenerRegistered=!0),gt.timer&&clearInterval(gt.timer),gt.timer=setInterval(function(){if(G(),et(),H(),gt.player[Rt.MAIN_PLAYER].isAlive||(T(),gt.hasMoved=!0),gt.requestToStartCurrentTurn){if(0==gt.bullets.length&&0==gt.explosions.length){if(gt.startDelay>0)return void gt.startDelay--;gt.requestToStartCurrentTurn=!1,a()}}else if(gt.currentTurn==yt.userid&&gt.hasMoved&&gt.isGamePlaying&&0==gt.bullets.length&&!gt.player[Rt.MAIN_PLAYER].command.ANOTHER_SHOOT){if(gt.endOfTurnDelay>0)return void gt.endOfTurnDelay--;s()}gt.requestWindChange&&0==gt.bullets.length&&0==gt.explosions.length&&(gt.requestWindChange=!1,Tt(gt.requestedWindAngle,gt.requestedWindPower),m("[NOTICE] WIND HAS CHANGED."))},Rt.TIME_DELTA)}function H(){if(gt.snapshotDelta--,gt.snapshotDelta<=0){gt.snapshotBlocked=!1;var e=gt.player[Rt.MAIN_PLAYER];Et.emit("current_snapshot",{userid:yt.userid,username:yt.username,x:e.x,y:e.y,orientation:e.orientation,angle:e.angle,v:e.v,dir:e.dir,hp:e.hp}),gt.snapshotDelta=Rt.SNAPSHOT_TIMEFRAME}}function B(e){return[e.pageX-gt.display.offsetLeft,e.pageY-gt.display.offsetTop]}function D(){addEventListener("mousedown",function(e){return N(e)?void W(e):(gt.viewMode.SHIFT_VIEW_MODE=!0,gt.shiftOrigin=B(e),gt.mouseOffset=B(e),void(gt.prevViewOffset=[gt.viewOffset[0],gt.viewOffset[1]]))}),addEventListener("mouseup",function(){gt.viewMode.SHIFT_VIEW_MODE=!1}),addEventListener("mousemove",function(e){gt.mouseOffset=B(e)}),addEventListener("keydown",function(e){8!=e.which&&13!=e.which||gt.chatFocused||!gt.isGamePlaying||document.getElementById("chat_input").focus();var t=gt.currentTurn==yt.userid;gt.hasMoved&&(t=!1),37==e.which?(t&&(gt.player[Rt.MAIN_PLAYER].thrust=-Rt.PLAYER_SPEED),gt.player[Rt.MAIN_PLAYER].orientation=-1,gt.viewMode.LOCKED_PLAYER_VIEW_MODE=!0):39==e.which?(t&&(gt.player[Rt.MAIN_PLAYER].thrust=Rt.PLAYER_SPEED),gt.player[Rt.MAIN_PLAYER].orientation=1,gt.viewMode.LOCKED_PLAYER_VIEW_MODE=!0):38==e.which?gt.player[Rt.MAIN_PLAYER].command.ADJUST_ANGLE_UP=!0:40==e.which?gt.player[Rt.MAIN_PLAYER].command.ADJUST_ANGLE_DOWN=!0:32==e.which&&t&&!gt.chatFocused&&(gt.player[Rt.MAIN_PLAYER].command.CHARGING_POWER||(gt.player[Rt.MAIN_PLAYER].command.CHARGE_POWER=!0))}),addEventListener("keyup",function(e){gt.isGamePlaying&&(gt.player[Rt.MAIN_PLAYER].thrust=0,gt.player[Rt.MAIN_PLAYER].command={CHARGING_POWER:gt.player[Rt.MAIN_PLAYER].command.CHARGING_POWER,CHARGE_POWER:gt.player[Rt.MAIN_PLAYER].command.CHARGE_POWER},32!=e.which||gt.hasMoved||gt.chatFocused||(gt.hasMoved=!0,gt.player[Rt.MAIN_PLAYER].command.SHOOT=!0,gt.player[Rt.MAIN_PLAYER].command.CHARGING_POWER=!1,gt.player[Rt.MAIN_PLAYER].command.CHARGE_POWER=!1,Et.emit("player_shoot",{userid:yt.userid,x:gt.player[Rt.MAIN_PLAYER].x,y:gt.player[Rt.MAIN_PLAYER].y,v:gt.player[Rt.MAIN_PLAYER].v,orientation:gt.player[Rt.MAIN_PLAYER].orientation,angle:gt.player[Rt.MAIN_PLAYER].angle,dir:gt.player[Rt.MAIN_PLAYER].dir,power:gt.player[Rt.MAIN_PLAYER].power}),gt.snapshotDelta=Rt.SNAPSHOT_EXTRA_DELAY,gt.snapshotBlocked=!0))}),document.getElementById("chat_input").addEventListener("focus",function(){gt.chatFocused||(gt.chatFocused=!0,document.getElementById("chat_ui_notif").style.setProperty("display","block"))}),document.getElementById("chat_input").addEventListener("blur",function(){gt.chatFocused=!1,document.getElementById("chat_ui_notif").style.setProperty("display","none")}),document.getElementById("chat_input").addEventListener("keydown",function(e){return 13==e.which?(document.getElementById("chat_input").blur(),d(document.getElementById("chat_input").value),document.getElementById("chat_input").value="",e.stopPropagation(),!1):document.getElementById("chat_input").value.length<100||8==e.which?void 0:(e.preventDefault(),!1)})}function N(e){var t=B(e),o=(gt.display.width-Rt.CONTROL_BAR_WIDTH)/2,i=gt.display.height-Rt.CONTROL_BAR_HEIGHT;return o<t[0]&&t[0]<o+Rt.CONTROL_BAR_WIDTH&&i<t[1]&&t[1]<i+Rt.CONTROL_BAR_HEIGHT}function W(e){var t=B(e),o=(gt.display.width-Rt.CONTROL_BAR_WIDTH)/2,i=gt.display.height-Rt.CONTROL_BAR_HEIGHT;if(t[0]-=o,t[1]-=i,t[1]>Rt.CONTROL_BAR_HEIGHT-Rt.POWER_BAR_HEIGHT)return void mt(t[0]/Rt.CONTROL_BAR_WIDTH);if(gt.currentTurn==yt.userid&&!gt.hasMoved&&(!gt.player[Rt.MAIN_PLAYER].command.USE_ITEM||0==gt.player[Rt.MAIN_PLAYER].command.USE_ITEM.use&&!gt.usedItem))for(var n=0;n<Rt.MAX_ITEM_BAR_SLOTS;++n)n*Rt.ITEM_SLOT_WIDTH<t[0]-Rt.ANGLE_BAR_WIDTH&&t[0]-Rt.ANGLE_BAR_WIDTH<(n+1)*Rt.ITEM_SLOT_WIDTH&&(gt.usedItem=!0,gt.player[Rt.MAIN_PLAYER].command.USE_ITEM={use:!0,which:n},Et.emit("player_use_item",{which:n}))}function G(){k(),C(),x(),Y()}function C(){for(var e=0;e<gt.explosions.length;++e)U(gt.explosions[e]);gt.explosions=[]}function x(){for(var e=0;e<gt.player.length;++e)e!=Rt.MAIN_PLAYER&&yt.currentRoom.member[e]&&yt.currentRoom.member[e].currentSnapshot&&!yt.currentRoom.member[e].currentSnapshot.obsolete&&(Math.abs(gt.player[e].x-yt.currentRoom.member[e].currentSnapshot.x)<Rt.X_ERROR_TOLERANCE?(gt.player[e].x=yt.currentRoom.member[e].currentSnapshot.x,gt.player[e].y=yt.currentRoom.member[e].currentSnapshot.y,gt.player[e].orientation=yt.currentRoom.member[e].currentSnapshot.orientation,gt.player[e].v=yt.currentRoom.member[e].currentSnapshot.v,gt.player[e].dir=yt.currentRoom.member[e].currentSnapshot.dir,gt.player[e].hp=yt.currentRoom.member[e].currentSnapshot.hp,gt.player[e].thrust=0,yt.currentRoom.member[e].currentSnapshot.obsolete=!0):(gt.player[e].orientation=gt.player[e].x<yt.currentRoom.member[e].currentSnapshot.x?1:-1,gt.player[e].thrust=yt.currentRoom.member[e].suggestedThrust,gt.player[e].angle!=yt.currentRoom.member[e].currentSnapshot.angle&&(gt.player[e].command[gt.player[e].angle-yt.currentRoom.member[e].currentSnapshot.angle>0?"ADJUST_ANGLE_DOWN":"ADJUST_ANGLE_UP"]=!0))),gt.player[e].commandHandler(),gt.player[e].movementUpdate()}function Y(){for(var e=[],t=0;t<gt.bullets.length;++t)gt.bullets[t].update(gt),gt.bullets[t].isAlive&&e.push(gt.bullets[t]);gt.bullets=e}function k(){if(gt.viewMode.SHIFT_VIEW_MODE){gt.viewMode.LOCKED_PLAYER_VIEW_MODE=!1;var e=gt.mouseOffset[0]-gt.shiftOrigin[0],t=gt.mouseOffset[1]-gt.shiftOrigin[1];gt.viewOffset=[gt.prevViewOffset[0]+e*Rt.VIEW_SHIFT_RATIO,gt.prevViewOffset[1]+t*Rt.VIEW_SHIFT_RATIO]}else if(gt.viewMode.LOCKED_BULLET_VIEW_MODE)if(0==gt.bullets.length)gt.viewMode.LOCKED_BULLET_VIEW_MODE=!1;else{var o=[-gt.bullets[0].x+gt.display.width/2,-gt.bullets[0].y+gt.display.height/2];gt.viewOffset[0]-=.41*(gt.viewOffset[0]-o[0]),gt.viewOffset[1]-=.41*(gt.viewOffset[1]-o[1])}else gt.viewMode.LOCKED_PLAYER_VIEW_MODE&&(gt.viewOffset[0]=-gt.player[Rt.MAIN_PLAYER].x+gt.display.width/2,gt.viewOffset[1]=-gt.player[Rt.MAIN_PLAYER].y+gt.display.height/2);gt.viewOffset[1]>Rt.CAMERA_VIEW_UPPERLIMIT&&(gt.viewOffset[1]=Rt.CAMERA_VIEW_UPPERLIMIT),gt.viewOffset[1]<-Rt.WORLD_HEIGHT/2&&(gt.viewOffset[1]=-Rt.WORLD_HEIGHT/2),gt.viewOffset[0]>0&&(gt.viewOffset[0]=0),gt.viewOffset[0]<-Rt.WORLD_WIDTH/2&&(gt.viewOffset[0]=-Rt.WORLD_WIDTH/2)}function U(e){e.isExploded||(F(e),e.isExploded=!0),X(e)}function F(e){for(var t=0;t<gt.player.length;++t){var o=gt.player[t],i=e.x-o.x,n=e.y-o.y,r=Math.sqrt(i*i+n*n);r<e.radius+o.PLAYER_WIDTH/2&&o.receiveDamage(e.damage*(1-r/(e.radius+o.PLAYER_WIDTH/2)))}}function X(e){var t=gt.terrainBuffer.getContext("2d");t.save(),t.globalCompositeOperation="destination-out",t.beginPath(),t.arc(e.x-gt.terrainOffset[0],e.y-gt.terrainOffset[1],e.radius,0,2*Math.PI),t.fill(),t.globalCompositeOperation="source-atop",t.lineWidth=10,t.stroke(),t.restore(),gt.terrainData=t.getImageData(0,0,gt.terrainBuffer.width,gt.terrainBuffer.height)}function V(e,t,o,i){return{x:e,y:t,radius:o,damage:i,isExploded:!1}}function z(){var e=gt.wind.angle*Math.PI/180,t=gt.wind.strength;return[t*Math.cos(e),t*Math.sin(e)]}function q(e){for(var t=!1,o=.8*e.BULLET_RADIUS,i=0;i<gt.player.length;++i){var n=gt.player[i].PLAYER_HEIGHT/2*.8;if(Math.abs(e.x-gt.player[i].x)<o+n&&Math.abs(e.y-gt.player[i].y)<o+n){t=!0;break}}return t&&(e.aliveTime>Rt.ULTRA_HIGH_ANGLE?m("ULTRA HIGH ANGLE!!!!!!"):e.aliveTime>Rt.HIGH_ANGLE&&m("HIGH ANGLE!!!")),(K([e.x,e.y])||K([e.x-o,e.y-o])||K([e.x+o,e.y+o])||K([e.x+o,e.y-o])||K([e.x-o,e.y+o]))&&(t=!0,_t(e,gt.terrainBitsName)),t}function Q(e,t){e.x=t.x,e.y=t.y,e.dir=t.dir,e.v=t.v}function K(e){var t=e[0]-gt.terrainOffset[0],o=e[1]-gt.terrainOffset[1];return 0>t||0>o?!1:o<gt.terrainBuffer.height&&t<gt.terrainBuffer.width?gt.terrainData.data[Math.floor(o)*gt.terrainBuffer.width*4+4*Math.floor(t)+3]>Rt.OPAQUE_VALUE:!1}function J(e){var t=e.x,o=e.y,i=e.dir,n=[-i[1],i[0]],r=.5*Rt.PLAYER_HEIGHT,l=.5*Rt.PLAYER_WIDTH;return[[t+l*i[0]+r*n[0],o+l*i[1]+r*n[1]],[t-l*i[0]+r*n[0],o-l*i[1]+r*n[1]]]}function j(e,t){var o={x:t.x,y:e.y,dir:[e.dir[0],e.dir[1]],v:Rt.PLAYER_MASS},i=!1,n=!1,r=1;if(K(J(o)[0])||K(J(o)[1]))for(var l=e.y;;l-=r){o.y=l;var a=J(o),s=K(a[0]),T=K(a[1]);if(!s&&!T)break;i=s,n=T}else for(var l=e.y;l<t.y;l+=r){o.y=l;var a=J(o);if(i=K(a[0]),n=K(a[1]),i||n){o.y-=r;break}}if(i&&n)return o;var h,m,a=[J(o),J(t)];i?(h=a[0][0],m=a[1][1]):(h=a[0][1],m=a[1][0]);var d=[m[0]-h[0],m[1]-h[1]];for(Z(d),m=[h[0]+d[0]*Rt.PLAYER_WIDTH,h[1]+d[1]*Rt.PLAYER_WIDTH];K(m);)$(d,.4*Math.PI/180*(i?-1:1)),m[0]=h[0]+d[0]*Rt.PLAYER_WIDTH,m[1]=h[1]+d[1]*Rt.PLAYER_WIDTH;var u=[-d[1],d[0]];return d[0]<0&&(u[0]=-u[0],u[1]=-u[1]),o.x=h[0]+d[0]*Rt.PLAYER_WIDTH*.5-u[0]*Rt.PLAYER_HEIGHT*.5,o.y=h[1]+d[1]*Rt.PLAYER_WIDTH*.5-u[1]*Rt.PLAYER_HEIGHT*.5,d[0]<0&&(d[0]=-d[0],d[1]=-d[1]),o.dir=d,o}function Z(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);e[0]/=t,e[1]/=t}function $(e,t){var o=e[0],i=e[1];e[0]=o*Math.cos(t)+i*Math.sin(t),e[1]=-o*Math.sin(t)+i*Math.cos(t)}function et(){gt.g.fillStyle=gt.backgroundColor,gt.g.fillRect(0,0,gt.display.width,gt.display.height),gt.g.save(),gt.g.translate(gt.viewOffset[0],gt.viewOffset[1]),rt(),tt(),it(),nt(),gt.g.restore(),lt()}function tt(){for(var e=0;e<gt.player.length;++e)gt.player[e].render(gt.g);-1!=gt.currentTurn&&ot(yt.currentRoom.hashed_member[gt.currentTurn].player)}function ot(e){gt.g.save(),gt.g.globalAlpha=.5,gt.g.translate(e.x,e.y-90),At.renderAsset("pointer_arrow",gt.g),gt.g.restore()}function it(){for(var e=0;e<gt.bullets.length;++e)gt.bullets[e].render(gt.g)}function nt(){for(var e=[],t=0;t<gt.effects.length;++t)gt.effects[t].render(gt.g),gt.effects[t].isAlive&&e.push(gt.effects[t]);gt.effects=e}function rt(){gt.g.drawImage(gt.terrainBuffer,0,0,gt.terrainBuffer.width,gt.terrainBuffer.height,gt.terrainOffset[0],gt.terrainOffset[1],gt.terrainBuffer.width,gt.terrainBuffer.height)}function lt(){var e=gt.g;e.save(),e.fillStyle=Rt.CONTROL_BAR_COLOR,e.lineWidth=3,e.fillRect((gt.display.width-Rt.CONTROL_BAR_WIDTH-4)/2,gt.display.height-Rt.CONTROL_BAR_HEIGHT-30,Rt.CONTROL_BAR_WIDTH+4,Rt.CONTROL_BAR_HEIGHT+30),dt(),at(),ut(),st(),e.restore()}function at(){var e=gt.g;e.save(),e.translate(gt.display.width/2,80),e.save(),e.rotate((gt.wind.angle+90)*Math.PI/180),At.renderAsset("wind_compass",e),e.restore(),e.drawImage(gt.wind.bufferedCaption,0,0,gt.wind.bufferedCaption.width,gt.wind.bufferedCaption.height,-gt.wind.bufferedCaption.width/2,-gt.wind.bufferedCaption.height/2,gt.wind.bufferedCaption.width,gt.wind.bufferedCaption.height),e.restore()}function st(){var e=gt.g;e.save(),e.translate((gt.display.width-Rt.CONTROL_BAR_WIDTH)/2+Rt.ANGLE_BAR_WIDTH,gt.display.height-Rt.CONTROL_BAR_HEIGHT);var t=Rt.CONTROL_BAR_HEIGHT-Rt.POWER_BAR_HEIGHT;e.fillStyle="rgba(30,30,30,0.7)",e.strokeStyle="rgba(120, 120, 45, 0.4)",e.lineWidth=2;for(var o=0;o<Rt.MAX_ITEM_BAR_SLOTS;++o)e.fillRect(o*Rt.ITEM_SLOT_WIDTH,0,Rt.ITEM_SLOT_WIDTH,t);for(var o=0;o<Rt.MAX_ITEM_BAR_SLOTS;++o)"empty"!=gt.player[Rt.MAIN_PLAYER].itemSlot[o]&&(e.save(),e.translate(o*Rt.ITEM_SLOT_WIDTH+Rt.ITEM_SLOT_WIDTH/2,t/2),At.renderAsset(gt.player[Rt.MAIN_PLAYER].itemSlot[o],e),e.restore());for(var o=0;o<Rt.MAX_ITEM_BAR_SLOTS;++o)e.strokeRect(o*Rt.ITEM_SLOT_WIDTH,0,Rt.ITEM_SLOT_WIDTH,t);e.restore()}function Tt(e,t){gt.wind.angle=e,gt.wind.strength=t,gt.wind.bufferedCaption=ht(""+t,40,"white",2,"black")}function ht(e,t,o,i,n,r){var l=document.createElement("canvas"),a=l.getContext("2d");return a.font=t+"px "+(r||"Arial"),l.width=a.measureText(e).width,l.height=1.1*t,a.font=t+"px "+(r||"Arial"),a.fillStyle=o,a.fillText(e,0,l.height/1.3),n&&(a.strokeStyle=n,a.lineWidth=i,a.strokeText(e,0,l.height/1.3)),l}function mt(e){gt.powerBar.marker=e}function dt(){var e=gt.g;e.save(),e.fillStyle=Rt.POWER_BAR_COLOR;var t=(gt.display.width-Rt.CONTROL_BAR_WIDTH)/2,o=gt.display.height-Rt.POWER_BAR_HEIGHT;e.fillRect(t,o,Rt.CONTROL_BAR_WIDTH,Rt.POWER_BAR_HEIGHT);var i=(Rt.CONTROL_BAR_WIDTH-8)*gt.powerBar.power/Rt.MAX_POWER;e.fillStyle=Rt.POWER_BAR_ACTIVE_COLOR,e.fillRect(t+4,o+4,i,Rt.POWER_BAR_HEIGHT-8),e.strokeStyle="white",e.lineWidth=2;for(var n=0;4>n;++n)e.strokeRect(t+1+n*Rt.CONTROL_BAR_WIDTH/4,o+1,(Rt.CONTROL_BAR_WIDTH-5)/4,Rt.POWER_BAR_HEIGHT-2);e.fillStyle="yellow",e.fillRect(t+gt.powerBar.marker*Rt.CONTROL_BAR_WIDTH,o+1,7,Rt.POWER_BAR_HEIGHT-2),e.restore()}function ut(){var e=gt.g,t=(gt.display.width-Rt.CONTROL_BAR_WIDTH)/2,o=gt.display.height-Rt.CONTROL_BAR_HEIGHT,i=Rt.CONTROL_BAR_HEIGHT-Rt.POWER_BAR_HEIGHT,n=gt.player[Rt.MAIN_PLAYER],r=[n.dir[0]*n.orientation,n.dir[1]*n.orientation];r[0]=Math.floor(100*r[0])/100,r[1]=Math.floor(100*r[1])/100,$(r,Math.floor(n.angle)*n.orientation/180*Math.PI);var l=Math.floor(Math.atan2(r[1],r[0])/Math.PI*180);l=-l,l>90&&(l=180-l),-90>l&&(l=-180-l),e.fillStyle="rgba(244, 244, 0, 0.6)",e.fillRect(t,o,Rt.ANGLE_BAR_WIDTH,i),e.fillStyle="white",0>l&&(l=-l,e.fillStyle="rgba(244, 10, 0, 0.6)"),e.strokeStyle="black",e.font="bold 45px Arial",e.lineWidth=2;var a=45;e.fillText(l,t+12,o+a),e.strokeText(l,t+12,o+a),e.save(),e.translate(t+67,o+16),At.renderAsset("degree_circle",e),e.restore()}function ct(e,t,o){var i={};i.x=e,i.y=t,i.delta=40,i.isAlive=!0,i.caption=ht(""+Math.floor(o),30,"red",1,"black"),i.render=function(e){if(i.isAlive){var t=i.caption.width,o=i.caption.height;i.y-=1,e.drawImage(i.caption,0,0,t,o,i.x-t/2,i.y-o/2,t,o),i.delta--,i.delta>0||(i.isAlive=!1)}},gt.effects.push(i)}function _t(e,t){function o(e,t,o,i,n){var r={};return r.x=e,r.y=t,r.isAlive=!0,r.dir=i,r.spin=o,r.render=function(e){r.dir[1]+=Rt.GRAVITY,r.y+=r.dir[1],r.x+=r.dir[0],r.spin+=(r.spin>0?1:-1)*Math.PI/180,e.save(),e.translate(r.x,r.y),e.rotate(r.spin),At.renderAsset(n,e),e.restore(),r.y>Rt.WORLD_HEIGHT&&(r.isAlive=!1)},r}for(var i=15,n=0;3>n;++n)gt.effects.push(o(e.x+Math.random()*i-i/2,e.y+Math.random()*i-i/2,Math.random()-.5,[e.v[0]+Math.random()*i-i/2,e.v[1]+Math.random()*i-i/2],t))}function ft(e){var t={};return t.x=e.x,t.y=e.y,t.r=7,t.delta=50,t.isAlive=!0,t.render=function(e){t.r<70&&(t.r*=1.09),t.delta--,e.beginPath(),e.fillStyle="rgba(200, 244, 120, 0.5)",e.arc(t.x,t.y,t.r,0,2*Math.PI),e.fill(),t.delta>0||(t.isAlive=!1)},t}var Et=io.connect("wss://"+location.host+"/nextstep"),yt={roomList:[],terrainChoices:["lindbulm","herbestus","hearow","crepes"],listenerRegistered:!1};Et.on("connect",function(){console.log("connection successful")}),Et.on("userid",function(e){console.log("successfully login-ed as "+e.username+", userid: "+e.userid),document.getElementById("lobby_loading").style.setProperty("display","none"),yt.username=e.username,yt.userid=e.userid,document.getElementById("status").innerHTML="Welcome, <b>"+yt.username+"</b>!"}),Et.on("rooms",function(e){for(var t=0;t<e.length;++t)yt.roomList.push({title:e[t].room_title,id:e[t].room_id,gameType:e[t].game_type,roomSize:e[t].room_size});o()}),Et.on("room_created",function(e){console.log("a room is created: "+e.room_title+"["+e.room_id+"]"),yt.roomList.push({id:e.room_id,title:e.room_title,gameType:e.game_type,roomSize:e.room_size}),o(),e.ownerid==yt.userid&&(console.log("you are the owner of the room"),yt.currentRoom={roomId:e.room_id,roomTitle:e.room_title,owner:yt.userid,roomSize:e.room_size,gameType:e.game_type,member:[{name:yt.username,id:yt.userid}],hashed_member:{},status:"ready",exitedMember:[]},yt.currentRoom.hashed_member[yt.userid]=yt.currentRoom.member[0],A())}),Et.on("entered_room",function(e){e.userid==yt.userid?console.log("You entered a room."):(console.log(e.username+" has entered the room."),yt.currentRoom.member.push({name:e.username,id:e.userid}),yt.currentRoom.hashed_member[e.userid]=yt.currentRoom.member[yt.currentRoom.member.length-1],A())}),Et.on("joined_room",function(e){console.log("updating room information"),yt.currentRoom={roomId:e.room_id,roomTitle:e.room_title,owner:e.ownerid,member:e.member,hashed_member:{},status:"ready",exitedMember:[],roomSize:e.room_size,gameType:e.game_type};for(var t=0;t<yt.currentRoom.member.length;++t)yt.currentRoom.hashed_member[yt.currentRoom.member[t].id]=yt.currentRoom.member[t];A()}),Et.on("initialize",function(){for(var e={player:[],terrain:null},t=350,o=(2500-2*t)/8,i=[],n=0;8>n;++n)i.push(n*o+t+10*(Math.random()-1));for(var n=0;n<yt.currentRoom.member.length;++n){var l="rgb("+Math.floor(255*Math.random())+","+Math.floor(255*Math.random())+","+Math.floor(255*Math.random())+")",a=Math.floor(Math.random()*i.length);a==i.length&&(a=i.length-1);var s=i[a];a!=i.length-1&&(i[a]=i[i.length-1]),i.pop(),gt.player.push(new v(s,0,l,yt.currentRoom.member[n].name+(yt.currentRoom.member[n].team?" ["+yt.currentRoom.member[n].team+"]":""))),e.player.push({x:s,y:0,color:l,username:yt.currentRoom.member[n].name+(yt.currentRoom.member[n].team?" ["+yt.currentRoom.member[n].team+"]":""),userid:yt.currentRoom.member[n].id}),yt.currentRoom.member[n].id==yt.userid&&(Rt.MAIN_PLAYER=n),yt.currentRoom.member[n].player=gt.player[gt.player.length-1]}e.terrain=r(),gt.terrainAssetName=e.terrain,gt.initialized=!0,Et.emit("initialize",e)}),Et.on("initial_values",function(e){if(!gt.initialized){for(var t=0;t<e.player.length;++t){var o=e.player[t];gt.player.push(new v(o.x,o.y,o.color,o.username)),yt.currentRoom.hashed_member[o.userid].player=gt.player[gt.player.length-1],o.userid==yt.userid&&(Rt.MAIN_PLAYER=t)}gt.terrainAssetName=e.terrain}document.getElementById("room_layer").style.display="none",document.getElementById("lobby_layer").style.display="none",document.getElementById("login_layer").style.display="none",document.getElementById("room_start_game_button").innerHTML="Start Game",document.getElementById("room_start_game_button").style.cursor="pointer",yt.currentRoom.starting=!1,S()}),Et.on("turn",function(e){gt.isGamePlaying&&(gt.currentTurn=e.userid,yt.userid==gt.currentTurn?(gt.startDelay=Rt.START_DELAY,gt.requestToStartCurrentTurn=!0):(document.getElementById("clock").innerHTML="",l(e.userid)))}),Et.on("snapshot",function(e){if(!gt.snapshotBlocked&&gt.isGamePlaying){var t=yt.currentRoom.hashed_member[e.userid];0==gt.bullets.length&&0==gt.explosions.length&&(t.currentSnapshot=e.snapshot,t.currentSnapshot.obsolete=!1,t.suggestedThrust=Math.abs(t.player.x-t.currentSnapshot.x-1)/Rt.SNAPSHOT_TIMEFRAME*(t.player.x<t.currentSnapshot.x?1:-1))}}),Et.on("player_shoot",function(e){if(gt.isGamePlaying&&e.userid!=yt.userid){var t=yt.currentRoom.hashed_member[e.userid];t.currentSnapshot&&(t.currentSnapshot.obsolete=!0),t.player.x=e.shoot_info.x,t.player.y=e.shoot_info.y,t.player.v=e.shoot_info.v,t.player.orientation=e.shoot_info.orientation,t.player.power=e.shoot_info.power,t.player.dir=e.shoot_info.dir,t.player.angle=e.shoot_info.angle,t.player.thrust=0,t.player.command.SHOOT=!0}}),Et.on("player_use_item",function(e){if(gt.isGamePlaying&&e.userid!=yt.userid){var t=yt.currentRoom.hashed_member[e.userid];t.player.command.USE_ITEM={use:!0,which:e.item_info.which}}}),Et.on("delay_stack",function(e){gt.isGamePlaying&&(yt.currentRoom.stack=e.data)}),Et.on("exit_room",function(e){e.userid==yt.userid&&I(),"playing"==yt.currentRoom.status?(yt.currentRoom.hashed_member[e.userid].player.isAlive=!1,gt.currentTurn==e.userid&&Et.emit("turn_request"),yt.currentRoom.exitedMember.push(e.userid)):(h(e.userid),A())}),Et.on("message",function(e){e.userid!=yt.userid&&(gt.messageQueue.push({id:e.userid,name:yt.currentRoom.hashed_member[e.userid].name,msg:e.msg}),gt.isGamePlaying&&yt.currentRoom.hashed_member[e.userid].player.setShoutout(e.msg),u(),L())}),Et.on("room_destroyed",function(e){console.log("room["+e.room_id+"] destroyed");for(var t=[],i=0;i<yt.roomList.length;++i)yt.roomList[i].id!=e.room_id&&t.push(yt.roomList[i]);yt.roomList=t,o()}),Et.on("force_update",function(e){if(e.userid!=yt.userid){var t=yt.currentRoom.hashed_member[e.userid],o=t.player;o.x=e.state.x,o.y=e.state.y,o.v=e.state.v,o.hp=e.state.hp,o.dir=e.state.dir,o.orientation=e.state.orientation,o.angle=e.state.angle,o.thrust=0,t.currentSnapshot&&(t.currentSnapshot.obsolete=!0)
}}),Et.on("team_member",function(e){yt.currentRoom.hashed_member[e.userid].team=e.team,A()}),Et.on("team_info",function(e){for(var t=0;t<e.length;++t)yt.currentRoom.hashed_member[e[t].userid].team=e[t].team;A()}),Et.on("winner",function(e){gt.isGamePlaying&&(gt.gameResult="team"==yt.currentRoom.gameType?e.team==yt.currentRoom.hashed_member[yt.userid].team?"win":"lose":e.userid==yt.userid?"win":"lose",E())}),Et.on("wind_change",function(e){gt.isGamePlaying&&(gt.requestWindChange=!0,gt.requestedWindAngle=e.angle,gt.requestedWindPower=e.power,console.log("wind_change!"))}),Et.on("new_room_owner",function(e){yt.currentRoom&&(yt.currentRoom.owner=e.userid,A())}),Et.on("start_game_failure",function(){document.getElementById("room_start_game_button").innerHTML="Start Game",document.getElementById("room_start_game_button").style.cursor="pointer",yt.currentRoom.starting=!1,m("Game start failure. Room is not fully occupied yet."),L()}),v.prototype.bufferCaption=function(){this.bufferedCaption=ht(this.name,21,"white")},v.prototype.render=function(e){if(this.renderable){var t=Math.atan2(this.dir[1],this.dir[0]);e.save(),e.translate(this.x,this.y),e.save(),e.rotate(t),this==gt.player[Rt.MAIN_PLAYER]&&this.renderAngleProtractor(e),this.renderBody(e),this.renderBarrel(e),e.restore(),this.renderNameCaption(e),this.isAlive&&this.renderHealthBar(e),this.renderShoutout(e),e.restore()}},v.prototype.renderAngleProtractor=function(e){e.save(),e.scale(this.orientation,1),e.translate(44,-44),e.globalAlpha=.75,At.renderAsset("angle_protractor",e),e.restore()},v.prototype.renderBody=function(e){this.isAlive||(this.PLAYER_HEIGHT=30,this.color="#633",this.BARREL_COLOR="#633"),e.fillStyle=this.color,this.damagedDelta>0&&(this.damagedDelta--,e.fillStyle="red",e.strokeStyle="red"),e.lineWidth=3,e.fillRect(-this.PLAYER_WIDTH/2,-this.PLAYER_HEIGHT/2,this.PLAYER_WIDTH,this.PLAYER_HEIGHT),e.strokeRect(-this.PLAYER_WIDTH/2,-this.PLAYER_HEIGHT/2,this.PLAYER_WIDTH,this.PLAYER_HEIGHT)},v.prototype.renderBarrel=function(e){e.save(),e.scale(this.orientation,1),e.rotate(-this.angle*Math.PI/180),e.fillStyle=this.BARREL_COLOR,e.lineWidth=2,e.fillRect(0,-this.BARREL_HEIGHT/2,this.BARREL_WIDTH,this.BARREL_HEIGHT),e.strokeRect(0,-this.BARREL_HEIGHT/2,this.BARREL_WIDTH,this.BARREL_HEIGHT),e.restore()},v.prototype.renderNameCaption=function(e){var t=this.bufferedCaption.width,o=this.bufferedCaption.height;e.fillStyle="rgba(0,0,0, 0.6)",e.fillRect(-(t+10)/2,20,t+10,o),e.drawImage(this.bufferedCaption,0,0,t,o,-t/2,20,t,o)},v.prototype.renderHealthBar=function(e){var t=Rt.HEALTH_BAR_LENGTH,o=6,i=-48;e.fillStyle="red",e.fillRect(-t/2,i,t,o),e.fillStyle="green",e.fillRect(-t/2,i,t*this.hp/this.MAX_HEALTH_POINT,o)},v.prototype.renderShoutout=function(e){this.shoutoutDelta>0&&(this.shoutoutDelta--,e.save(),e.strokeStyle="black",e.lineWidth=1,e.fillStyle="rgba(255,255,255,0.85)",e.translate(40,-this.bufferedShoutout.height-50),e.fillRect(-4,0,this.bufferedShoutout.width+8,this.bufferedShoutout.height),e.drawImage(this.bufferedShoutout,0,0,this.bufferedShoutout.width,this.bufferedShoutout.height,4,0,this.bufferedShoutout.width,this.bufferedShoutout.height),e.strokeRect(-4,0,this.bufferedShoutout.width+8,this.bufferedShoutout.height),e.restore())},v.prototype.commandHandler=function(){if(this.command.ADJUST_ANGLE_UP&&(this.angle+=Rt.ANGLE_DELTA,this.angle>this.ANGLE_UPPER_LIMIT&&(this.angle=this.ANGLE_UPPER_LIMIT),this.command.ADJUST_ANGLE_UP=!1),this.command.ADJUST_ANGLE_DOWN&&(this.angle-=Rt.ANGLE_DELTA,this.angle<this.ANGLE_LOWER_LIMIT&&(this.angle=this.ANGLE_LOWER_LIMIT),this.command.ADJUST_ANGLE_DOWN=!1),this.command.CHARGE_POWER&&(this.command.CHARGING_POWER=!0,this.command.CHARGE_POWER=!1,this.power=0),this.command.CHARGING_POWER&&(this.power+=Rt.POWER_DELTA,this.power>Rt.MAX_POWER&&(this.power=Rt.MAX_POWER),this==gt.player[Rt.MAIN_PLAYER]&&(gt.powerBar.power=this.power)),this.command.ANOTHER_SHOOT&&(this.shootingDelay--,this.shootingDelay>0||(gt.bullets.push(this.createBullet()),this.command.ANOTHER_SHOOT=!1)),this.command.SHOOT&&(gt.bullets.push(this.createBullet()),"dual"==this.shootingPowerUp&&(this.command.ANOTHER_SHOOT=!0,this.shootingDelay=50),this.shootingPowerUp="none",this.command.SHOOT=!1,gt.viewMode.LOCKED_BULLET_VIEW_MODE=!0,gt.viewMode.LOCKED_PLAYER_VIEW_MODE=!1),this.command.USE_ITEM&&this.command.USE_ITEM.use){var e=this.command.USE_ITEM.which;"empty"!=this.itemSlot[e]&&(gt.effects.push(ft(this)),"health"==this.itemSlot[e]?(this.hp+=Rt.ITEM_HEALTH_UP_EFFECT,this.hp>this.MAX_HEALTH_POINT&&(this.hp=this.MAX_HEALTH_POINT)):"dual"==this.itemSlot[e]?this.shootingPowerUp="dual":"power"==this.itemSlot[e]&&(this.shootingPowerUp="power"),this.itemSlot[e]="empty")}},v.prototype.createBullet=function(){var e=[this.orientation*this.dir[0],this.orientation*this.dir[1]];e[0]=Math.floor(100*e[0])/100,e[1]=Math.floor(100*e[1])/100,$(e,this.orientation*Math.floor(this.angle)*Math.PI/180);var t=Math.floor(Math.atan2(e[1],e[0])/Math.PI*180);e[0]=Math.cos(t/180*Math.PI),e[1]=Math.sin(t/180*Math.PI);var o=this.x+e[0]*(this.BARREL_WIDTH+20),i=this.y+e[1]*(this.BARREL_WIDTH+20),n=this.power/Rt.MAX_POWER*this.MAX_BULLET_THRUST,r=[n*e[0],n*e[1]];return this.bulletFactory(o,i,r)},v.prototype.bulletFactory=function(e,t,o){return"power"==this.shootingPowerUp?new P(e,t,o):new b(e,t,o)},v.prototype.movementUpdate=function(){if(this.renderable){var e={x:this.x,y:this.y,dir:[this.dir[0],this.dir[1]],v:this.v};e.v+=Rt.GRAVITY,e.y+=e.v;var t=J(e);(K(t[0])||K(t[1]))&&(e=j(this,e)),Q(this,e),t=J(e),K(t[0])||K(t[1])||(e.x+=this.thrust,t=J(e),(K(t[0])||K(t[1]))&&(e=j(this,e)),this.y-e.y<this.PLAYER_VERTICAL_MOVEMENT_LIMIT&&Q(this,e),this.y>Rt.WORLD_WIDTH&&(this.isAlive=!1,this.renderable=!1))}},v.prototype.receiveDamage=function(e){this.isAlive&&(this.hp-=e,this.damagedDelta=20,this.hp>0||(this.hp=0,this.isAlive=!1),ct(this.x,this.y-20,e))},v.prototype.setShoutout=function(e){this.shoutoutDelta=300,this.lastMessage=e,gt.g.font="21px Arial";var t=gt.g.measureText(e).width,o=t/e.length,i=250,n=25.2,r=Math.floor(i/o),l=0;this.bufferedShoutout=document.createElement("canvas"),this.bufferedShoutout.width=Math.min(t,i)+8,this.bufferedShoutout.height=Math.ceil(t/i)*n;var a=this.bufferedShoutout.getContext("2d");a.font="21px Arial",a.fillStyle="black",a.textBaseline="top";for(var s=0;s<e.length;s+=r){var T=e.substring(s,Math.min(e.length,s+r));if(s+r<e.length){var h=e[s+r];" "!=h&&"."!=h&&(T+="-")}a.fillText(T,0,l),l+=n}},b.prototype.update=function(e){(this.x<0||this.x>Rt.WORLD_WIDTH||this.y>Rt.WORLD_HEIGHT||this.y<Rt.LOWEST_Y_LIMIT)&&(this.isAlive=!1),this.x+=this.v[0],this.y+=this.v[1],q(this)&&(e.explosions.push(V(this.x,this.y+16,this.EXPLOSION_RADIUS,this.EXPLOSION_DAMAGE)),this.isAlive=!1);var t=z();this.v[0]+=t[0]*this.WIND_STRENGTH_CALLIBRATOR,this.v[1]+=t[1]*this.WIND_STRENGTH_CALLIBRATOR+this.GRAVITY,this.aliveTime++},b.prototype.render=function(e){var t=Math.atan2(this.v[1],this.v[0]);e.save(),e.translate(this.x,this.y),e.rotate(t),this.renderBody(e),e.restore()},b.prototype.renderBody=function(e){e.fillStyle="#f01",e.lineWidth=3,e.fillRect(-this.BULLET_RADIUS-10,-this.BULLET_RADIUS,this.BULLET_RADIUS+20,2*this.BULLET_RADIUS),e.fillStyle="white",e.fillRect(-this.BULLET_RADIUS,-this.BULLET_RADIUS,10,2*this.BULLET_RADIUS),e.strokeRect(-this.BULLET_RADIUS-10,-this.BULLET_RADIUS,this.BULLET_RADIUS+20,2*this.BULLET_RADIUS)},P.prototype=Object.create(b.prototype),addEventListener("DOMContentLoaded",function(){c(),f(),y(),O(),At.lobby.play()});var gt={player:[],viewMode:{},viewOffset:[0,0],terrainOffset:[250,0],powerBar:{power:0,marker:0},bullets:[],explosions:[],effects:[],wind:{angle:-90,strength:0,bufferedCaption:ht("0",50,"white",2,"black")},terrainBitsName:null,snapshotDelta:200,usedItem:!1,currentTurn:-1,hasMoved:!0,countdown:null,turnStartTime:0,requestToStartCurrentTurn:!1,timePenalty:0,startDelay:200,listenerRegistered:!1,chatFocused:!1,messageQueue:[],lastMessageTime:0,isGamePlaying:!1,backgroundColor:"white",terrainAssetName:"crepes",terrainBitsName:"green_terrain_bits",initialized:!1},Rt={MAIN_PLAYER:0,TIME_DELTA:1e3/60,PLAYER_WIDTH:64,PLAYER_HEIGHT:64,PLAYER_SPEED:1,PLAYER_MASS:3,ANGLE_DELTA:1,ANGLE_LOWER_LIMIT:20,ANGLE_UPPER_LIMIT:55,GRAVITY:.28,OPAQUE_VALUE:80,WORLD_WIDTH:2500,WORLD_HEIGHT:1e3,BARREL_WIDTH:50,BARREL_HEIGHT:16,BARREL_COLOR:"#fff",CONTROL_BAR_COLOR:"rgba(0,0,0,0.6)",CONTROL_BAR_HEIGHT:100,CONTROL_BAR_WIDTH:1e3,MAX_POWER:200,POWER_BAR_HEIGHT:40,POWER_BAR_COLOR:"#000",POWER_BAR_RATIO:.8,POWER_DELTA:1,POWER_BAR_ACTIVE_COLOR:"#f00",ANGLE_BAR_WIDTH:80,BULLET_RADIUS:10,MAX_BULLET_THRUST:40,MAX_WIND_STRENGTH:10,EXPLOSION_RADIUS:60,WIND_STRENGTH_CALLIBRATOR:.015,HEALTH_BAR_LENGTH:80,VIEW_SHIFT_RATIO:1.5,CAMERA_VIEW_UPPERLIMIT:1300,PLAYER_VERTICAL_MOVEMENT_LIMIT:8,MAX_ITEM_BAR_SLOTS:3,ITEM_SLOT_WIDTH:200,ITEM_HEALTH_UP_EFFECT:500,SNAPSHOT_TIMEFRAME:100,X_ERROR_TOLERANCE:1,SLOWDOWN_CONSTANT:.5,MESSAGE_FLOOD_LIMIT:200,MAX_MESSAGE_DISPLAY:10,START_DELAY:80,END_OF_TURN_DELAY:100,HIGH_ANGLE:200,ULTRA_HIGH_ANGLE:400,LOWEST_Y_LIMIT:-2600,SNAPSHOT_EXTRA_DELAY:300},pt={get:function(e){return terrainBuffer=document.createElement("canvas"),this[e](terrainBuffer),terrainBuffer},test_asset01:function(e){var t=1e3,o=600;e.width=t,e.height=o;var i=e.getContext("2d");i.clearRect(0,0,t,o),i.fillStyle="green",i.lineWidth=5,i.save(),i.translate(0,100),i.beginPath(),i.moveTo(238,410),i.lineTo(174,404),i.lineTo(112,370),i.lineTo(91,336),i.lineTo(86,285),i.lineTo(129,241),i.lineTo(168,227),i.lineTo(211,211),i.lineTo(237,200),i.lineTo(255,184),i.lineTo(270,153),i.lineTo(285,114),i.lineTo(295,79),i.lineTo(311,61),i.lineTo(338,50),i.lineTo(358,48),i.lineTo(377,57),i.lineTo(394,79),i.lineTo(411,104),i.lineTo(436,147),i.lineTo(456,180),i.lineTo(475,203),i.lineTo(514,226),i.lineTo(560,240),i.lineTo(594,242),i.lineTo(634,238),i.lineTo(653,229),i.lineTo(690,208),i.lineTo(715,187),i.lineTo(729,172),i.lineTo(764,148),i.lineTo(774,142),i.lineTo(790,138),i.lineTo(835,137),i.lineTo(892,145),i.lineTo(917,160),i.lineTo(949,185),i.lineTo(970,221),i.lineTo(985,253),i.lineTo(989,276),i.lineTo(978,316),i.lineTo(949,344),i.lineTo(917,369),i.lineTo(877,395),i.lineTo(811,416),i.lineTo(749,427),i.lineTo(665,435),i.lineTo(610,435),i.lineTo(530,428),i.lineTo(464,424),i.lineTo(401,414),i.lineTo(353,410),i.lineTo(297,404),i.closePath(),i.fill(),i.stroke(),i.restore()},test_asset02:function(e){var t=1800,o=600;e.width=t,e.height=o;var i=e.getContext("2d");i.clearRect(0,0,t,o),i.fillStyle="green",i.lineWidth=5,i.save(),i.beginPath(),i.moveTo(504,516),i.lineTo(444,519),i.lineTo(344,523),i.lineTo(271,515),i.lineTo(205,506),i.lineTo(150,482),i.lineTo(125,455),i.lineTo(104,424),i.lineTo(90,392),i.lineTo(79,337),i.lineTo(79,276),i.lineTo(79,237),i.lineTo(96,198),i.lineTo(134,175),i.lineTo(195,153),i.lineTo(232,150),i.lineTo(287,167),i.lineTo(328,201),i.lineTo(368,208),i.lineTo(409,221),i.lineTo(449,225),i.lineTo(511,237),i.lineTo(572,240),i.lineTo(607,242),i.lineTo(658,242),i.lineTo(696,229),i.lineTo(718,198),i.lineTo(752,185),i.lineTo(801,179),i.lineTo(834,190),i.lineTo(871,204),i.lineTo(901,227),i.lineTo(945,235),i.lineTo(981,233),i.lineTo(1033,233),i.lineTo(1074,208),i.lineTo(1075,176),i.lineTo(1080,139),i.lineTo(1120,121),i.lineTo(1179,121),i.lineTo(1236,138),i.lineTo(1263,167),i.lineTo(1290,191),i.lineTo(1320,224),i.lineTo(1343,270),i.lineTo(1326,326),i.lineTo(1295,358),i.lineTo(1263,364),i.lineTo(1201,384),i.lineTo(1145,388),i.lineTo(1073,408),i.lineTo(997,426),i.lineTo(939,442),i.lineTo(882,456),i.lineTo(854,402),i.lineTo(843,370),i.lineTo(816,340),i.lineTo(785,306),i.lineTo(745,275),i.lineTo(704,290),i.lineTo(689,330),i.lineTo(675,385),i.lineTo(661,425),i.lineTo(633,452),i.lineTo(591,480),i.lineTo(556,494),i.closePath(),i.fill(),i.stroke(),i.restore()},test_asset03:function(e){e.width=2e3,e.height=600;var t=e.getContext("2d");t.clearRect(0,0,2e3,600),t.fillStyle="green",t.lineWidth="5",t.beginPath(),t.moveTo(200,475),t.lineTo(131,418),t.lineTo(100,353),t.lineTo(93,277),t.lineTo(122,192),t.lineTo(221,161),t.lineTo(308,170),t.lineTo(386,201),t.lineTo(443,221),t.lineTo(519,248),t.lineTo(583,260),t.lineTo(657,265),t.lineTo(724,267),t.lineTo(785,267),t.lineTo(845,264),t.lineTo(891,246),t.lineTo(944,211),t.lineTo(999,183),t.lineTo(1043,169),t.lineTo(1094,169),t.lineTo(1218,209),t.lineTo(1256,220),t.lineTo(1294,232),t.lineTo(1341,248),t.lineTo(1390,249),t.lineTo(1448,242),t.lineTo(1516,203),t.lineTo(1583,148),t.lineTo(1615,131),t.lineTo(1643,121),t.lineTo(1682,115),t.lineTo(1720,117),t.lineTo(1755,125),t.lineTo(1792,135),t.lineTo(1828,161),t.lineTo(1864,195),t.lineTo(1890,243),t.lineTo(1909,302),t.lineTo(1893,364),t.lineTo(1845,434),t.lineTo(1633,508),t.lineTo(1477,512),t.lineTo(1278,471),t.lineTo(1123,409),t.lineTo(1030,381),t.lineTo(864,391),t.lineTo(744,416),t.lineTo(662,436),t.lineTo(584,447),t.lineTo(505,437),t.lineTo(452,413),t.lineTo(351,397),t.lineTo(292,409),t.lineTo(246,458),t.closePath(),t.fill(),t.stroke()},test_asset04:function(e){e.width=2e3,e.height=600;var t=e.getContext("2d");t.clearRect(0,0,2e3,600),t.fillStyle="green",t.lineWidth="5",t.beginPath(),t.moveTo(259,484),t.lineTo(187,459),t.lineTo(158,425),t.lineTo(130,378),t.lineTo(125,328),t.lineTo(149,281),t.lineTo(193,275),t.lineTo(237,285),t.lineTo(291,300),t.lineTo(347,298),t.lineTo(388,273),t.lineTo(419,241),t.lineTo(464,212),t.lineTo(509,216),t.lineTo(529,251),t.lineTo(524,292),t.lineTo(503,338),t.lineTo(458,389),t.lineTo(413,440),t.lineTo(356,471),t.lineTo(311,477),t.closePath(),t.fill(),t.moveTo(742,530),t.lineTo(687,485),t.lineTo(665,447),t.lineTo(655,410),t.lineTo(657,366),t.lineTo(676,314),t.lineTo(729,279),t.lineTo(787,286),t.lineTo(831,328),t.lineTo(861,369),t.lineTo(912,405),t.lineTo(981,415),t.lineTo(1068,409),t.lineTo(1113,437),t.lineTo(1121,498),t.lineTo(1077,529),t.lineTo(1014,562),t.lineTo(928,568),t.lineTo(860,565),t.lineTo(815,555),t.closePath(),t.fill(),t.moveTo(1293,391),t.lineTo(1335,373),t.lineTo(1385,339),t.lineTo(1427,302),t.lineTo(1460,272),t.lineTo(1526,261),t.lineTo(1591,272),t.lineTo(1636,290),t.lineTo(1689,304),t.lineTo(1722,302),t.lineTo(1765,293),t.lineTo(1816,297),t.lineTo(1843,341),t.lineTo(1844,393),t.lineTo(1796,437),t.lineTo(1740,475),t.lineTo(1684,499),t.lineTo(1610,500),t.lineTo(1531,501),t.lineTo(1464,494),t.lineTo(1390,497),t.lineTo(1351,518),t.lineTo(1293,523),t.lineTo(1267,493),t.lineTo(1247,455),t.lineTo(1237,420),t.lineTo(1255,389),t.closePath(),t.fill(),t.stroke()},lindbulm:function(e){gt.backgroundColor="#FBF9FF",gt.terrainBitsName="green_terrain_bits",e.width=2e3,e.height=600;var t=e.getContext("2d");t.clearRect(0,0,2e3,600),t.fillStyle="green",t.lineWidth="5",t.beginPath(),t.moveTo(95,454),t.lineTo(28,410),t.lineTo(4,288),t.lineTo(18,218),t.lineTo(31,174),t.lineTo(56,157),t.lineTo(85,130),t.lineTo(145,117),t.lineTo(215,85),t.lineTo(259,40),t.lineTo(295,18),t.lineTo(362,6),t.lineTo(434,1),t.lineTo(485,11),t.lineTo(540,35),t.lineTo(576,59),t.lineTo(622,69),t.lineTo(685,70),t.lineTo(756,51),t.lineTo(820,32),t.lineTo(868,11),t.lineTo(947,9),t.lineTo(1018,32),t.lineTo(1192,48),t.lineTo(1240,38),t.lineTo(1286,28),t.lineTo(1329,12),t.lineTo(1401,7),t.lineTo(1538,33),t.lineTo(1594,54),t.lineTo(1655,64),t.lineTo(1720,48),t.lineTo(1769,20),t.lineTo(1845,15),t.lineTo(1909,19),t.lineTo(1953,59),t.lineTo(1985,91),t.lineTo(1981,148),t.lineTo(1982,216),t.lineTo(1928,287),t.lineTo(1901,338),t.lineTo(1883,426),t.lineTo(1874,517),t.lineTo(1856,581),t.lineTo(1698,587),t.lineTo(1596,582),t.lineTo(1549,548),t.lineTo(1469,526),t.lineTo(1367,532),t.lineTo(1273,544),t.lineTo(1030,552),t.lineTo(965,539),t.lineTo(896,493),t.lineTo(775,473),t.lineTo(579,416),t.lineTo(425,426),t.lineTo(347,450),t.lineTo(275,487),t.lineTo(171,479),t.closePath(),t.fill(),t.stroke()},hearow:function(e){gt.backgroundColor="#FFA230",gt.terrainBitsName="hot_terrain_bits",e.width=2e3,e.height=600;var t=e.getContext("2d");t.clearRect(0,0,2e3,600),t.fillStyle="#EB3725",t.lineWidth="5",t.beginPath(),t.moveTo(370,358),t.lineTo(260,354),t.lineTo(185,395),t.lineTo(140,474),t.lineTo(38,449),t.lineTo(21,388),t.lineTo(20,328),t.lineTo(43,248),t.lineTo(81,206),t.lineTo(157,162),t.lineTo(233,156),t.lineTo(327,156),t.lineTo(388,163),t.lineTo(428,115),t.lineTo(452,64),t.lineTo(511,12),t.lineTo(576,18),t.lineTo(617,53),t.lineTo(657,90),t.lineTo(703,153),t.lineTo(704,242),t.lineTo(660,294),t.lineTo(548,336),t.lineTo(454,353),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(588,439),t.lineTo(659,442),t.lineTo(735,432),t.lineTo(798,390),t.lineTo(834,337),t.lineTo(882,303),t.lineTo(977,253),t.lineTo(1058,244),t.lineTo(1156,253),t.lineTo(1229,280),t.lineTo(1275,326),t.lineTo(1329,361),t.lineTo(1381,376),t.lineTo(1439,380),t.lineTo(1477,457),t.lineTo(1477,518),t.lineTo(1368,556),t.lineTo(1271,576),t.lineTo(1151,583),t.lineTo(1045,551),t.lineTo(971,570),t.lineTo(915,577),t.lineTo(817,562),t.lineTo(715,563),t.lineTo(621,575),t.lineTo(571,526),t.lineTo(550,473),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(1458,208),t.lineTo(1343,195),t.lineTo(1297,151),t.lineTo(1274,98),t.lineTo(1313,52),t.lineTo(1369,31),t.lineTo(1466,15),t.lineTo(1578,17),t.lineTo(1655,40),t.lineTo(1702,78),t.lineTo(1781,100),t.lineTo(1853,101),t.lineTo(1907,111),t.lineTo(1949,133),t.lineTo(1992,189),t.lineTo(1991,256),t.lineTo(1974,331),t.lineTo(1923,369),t.lineTo(1815,386),t.lineTo(1748,314),t.lineTo(1655,290),t.lineTo(1583,268),t.lineTo(1525,246),t.closePath(),t.fill(),t.stroke()},herbestus:function(e){gt.backgroundColor="#F5FFFF",gt.terrainBitsName="snowy_terrain_bits",e.width=2e3,e.height=600;var t=e.getContext("2d");t.clearRect(0,0,2e3,600),t.fillStyle="#E8FFEE",t.lineWidth="5",t.beginPath(),t.moveTo(85,502),t.lineTo(58,478),t.lineTo(33,437),t.lineTo(25,402),t.lineTo(13,345),t.lineTo(2,297),t.lineTo(3,226),t.lineTo(0,136),t.lineTo(0,54),t.lineTo(17,20),t.lineTo(63,4),t.lineTo(136,2),t.lineTo(175,22),t.lineTo(216,48),t.lineTo(268,84),t.lineTo(307,122),t.lineTo(366,158),t.lineTo(412,181),t.lineTo(470,202),t.lineTo(535,214),t.lineTo(592,221),t.lineTo(648,237),t.lineTo(720,252),t.lineTo(785,261),t.lineTo(851,274),t.lineTo(937,290),t.lineTo(1003,296),t.lineTo(1068,299),t.lineTo(1131,296),t.lineTo(1185,288),t.lineTo(1252,275),t.lineTo(1306,264),t.lineTo(1365,257),t.lineTo(1420,237),t.lineTo(1474,228),t.lineTo(1559,199),t.lineTo(1633,182),t.lineTo(1690,160),t.lineTo(1754,136),t.lineTo(1795,111),t.lineTo(1835,64),t.lineTo(1868,36),t.lineTo(1910,25),t.lineTo(1948,33),t.lineTo(1972,59),t.lineTo(1986,92),t.lineTo(1995,133),t.lineTo(1980,205),t.lineTo(1956,271),t.lineTo(1892,331),t.lineTo(1832,389),t.lineTo(1765,424),t.lineTo(1672,459),t.lineTo(1579,481),t.lineTo(1491,497),t.lineTo(1413,504),t.lineTo(1347,516),t.lineTo(1246,521),t.lineTo(1151,530),t.lineTo(1038,534),t.lineTo(967,537),t.lineTo(901,521),t.lineTo(815,520),t.lineTo(717,519),t.lineTo(618,519),t.lineTo(519,523),t.lineTo(467,502),t.lineTo(415,436),t.lineTo(366,380),t.lineTo(305,344),t.lineTo(260,353),t.lineTo(233,367),t.lineTo(194,418),t.lineTo(170,454),t.lineTo(125,481),t.closePath(),t.fill(),t.stroke()},crepes:function(e){gt.backgroundColor="#FBF9FF",gt.terrainBitsName="green_terrain_bits",e.width=2e3,e.height=600;var t=e.getContext("2d");t.clearRect(0,0,2e3,600),t.fillStyle="green",t.lineWidth="5",t.beginPath(),t.moveTo(41,70),t.lineTo(121,65),t.lineTo(204,50),t.lineTo(284,59),t.lineTo(351,68),t.lineTo(410,68),t.lineTo(473,68),t.lineTo(488,98),t.lineTo(462,133),t.lineTo(392,139),t.lineTo(314,140),t.lineTo(248,146),t.lineTo(179,154),t.lineTo(77,139),t.lineTo(36,126),t.lineTo(13,99),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(361,236),t.lineTo(404,218),t.lineTo(455,206),t.lineTo(530,204),t.lineTo(598,204),t.lineTo(647,201),t.lineTo(709,201),t.lineTo(764,212),t.lineTo(816,223),t.lineTo(821,275),t.lineTo(765,300),t.lineTo(688,306),t.lineTo(630,302),t.lineTo(556,302),t.lineTo(469,315),t.lineTo(404,279),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(781,133),t.lineTo(855,116),t.lineTo(899,106),t.lineTo(966,99),t.lineTo(1018,97),t.lineTo(1076,108),t.lineTo(1128,110),t.lineTo(1184,116),t.lineTo(1197,143),t.lineTo(1167,167),t.lineTo(1099,186),t.lineTo(1044,186),t.lineTo(965,177),t.lineTo(895,178),t.lineTo(822,178),t.lineTo(778,184),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(723,196),t.lineTo(756,170),t.lineTo(790,162),t.lineTo(822,165),t.lineTo(811,215),t.lineTo(756,238),t.lineTo(699,232),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(1137,240),t.lineTo(1183,210),t.lineTo(1245,180),t.lineTo(1304,180),t.lineTo(1381,181),t.lineTo(1437,181),t.lineTo(1512,185),t.lineTo(1565,206),t.lineTo(1591,250),t.lineTo(1560,259),t.lineTo(1496,264),t.lineTo(1458,243),t.lineTo(1390,249),t.lineTo(1323,256),t.lineTo(1251,241),t.lineTo(1200,251),t.lineTo(1159,274),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(1546,135),t.lineTo(1570,117),t.lineTo(1631,94),t.lineTo(1713,82),t.lineTo(1796,81),t.lineTo(1851,81),t.lineTo(1896,89),t.lineTo(1942,99),t.lineTo(1963,124),t.lineTo(1959,164),t.lineTo(1920,170),t.lineTo(1873,157),t.lineTo(1815,157),t.lineTo(1787,154),t.lineTo(1741,159),t.lineTo(1679,165),t.lineTo(1618,167),t.lineTo(1559,165),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(1493,376),t.lineTo(1541,365),t.lineTo(1587,352),t.lineTo(1652,350),t.lineTo(1698,356),t.lineTo(1766,361),t.lineTo(1820,375),t.lineTo(1816,416),t.lineTo(1774,434),t.lineTo(1721,423),t.lineTo(1635,423),t.lineTo(1584,430),t.lineTo(1519,429),t.lineTo(1456,418),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(843,415),t.lineTo(886,395),t.lineTo(927,385),t.lineTo(980,377),t.lineTo(1052,371),t.lineTo(1103,378),t.lineTo(1146,397),t.lineTo(1165,429),t.lineTo(1150,450),t.lineTo(1097,462),t.lineTo(1044,460),t.lineTo(984,455),t.lineTo(900,454),t.lineTo(838,444),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(38,463),t.lineTo(72,438),t.lineTo(114,431),t.lineTo(185,428),t.lineTo(255,428),t.lineTo(317,430),t.lineTo(365,447),t.lineTo(385,474),t.lineTo(364,495),t.lineTo(286,506),t.lineTo(221,506),t.lineTo(148,506),t.lineTo(106,501),t.lineTo(52,504),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(1028,164),t.lineTo(898,198),t.lineTo(800,204),t.lineTo(726,175),t.lineTo(750,106),t.lineTo(892,68),t.lineTo(1052,58),t.lineTo(1153,61),t.lineTo(1205,85),t.lineTo(1229,131),t.lineTo(1151,169),t.lineTo(1102,156),t.closePath(),t.fill(),t.stroke()}},At=function(){var e={};e.buffer=document.createElement("canvas"),e.buffer.width=1e3,e.buffer.height=1e3;var t=e.buffer.getContext("2d");return t.clearRect(0,0,e.buffer.width,e.buffer.height),e.renderAsset=function(t,o){o.drawImage(e.buffer,e[t].offsetX,e[t].offsetY,e[t].width,e[t].height,-e[t].width/2,-e[t].height/2,e[t].width,e[t].height)},e.wind_compass={offsetX:0,offsetY:0,width:100,height:100},t.save(),t.translate(e.wind_compass.offsetX,e.wind_compass.offsetY),t.fillStyle="rgba(0,0,0,0.5)",t.lineWidth=5,t.beginPath(),t.arc(e.wind_compass.width/2,e.wind_compass.width/2,e.wind_compass.width/2-5,0,2*Math.PI),t.fill(),t.stroke(),t.beginPath(),t.fillStyle="rgba(22, 170, 131, 0.8)",t.moveTo(e.wind_compass.width/2,e.wind_compass.width/2+20),t.lineTo(e.wind_compass.width/2-20,e.wind_compass.width/2+30),t.lineTo(e.wind_compass.width/2,e.wind_compass.width/2-30),t.lineTo(e.wind_compass.width/2+20,e.wind_compass.width/2+30),t.closePath(),t.fill(),t.stroke(),t.restore(),e.green_terrain_bits={offsetX:100,offsetY:0,width:40,height:40},t.save(),t.fillStyle="green",t.lineWidth=3,t.translate(100,0),t.beginPath(),t.moveTo(13,9),t.lineTo(7,17),t.lineTo(5,26),t.lineTo(12,32),t.lineTo(20,32),t.lineTo(26,36),t.lineTo(33,31),t.lineTo(32,19),t.lineTo(33,9),t.lineTo(24,8),t.closePath(),t.fill(),t.stroke(),t.restore(),e.degree_circle={offsetX:0,offsetY:100,width:30,height:30},t.save(),t.translate(0,100),t.font="bold 20px Arial",t.fillStyle="white",t.strokeStyle="black",t.lineWidth=1,t.fillText("o",10,15),t.strokeText("o",10,15),t.restore(),e.angle_protractor={offsetX:30,offsetY:100,width:100,height:100},t.save(),t.translate(30,100),t.fillStyle="rgba(240, 240, 0, 0.3)",t.beginPath(),t.moveTo(0,100),t.arc(0,100,80,0,Math.PI/2,!0),t.closePath(),t.fill(),t.beginPath(),t.fillStyle="rgba(0,0,0,0.5)",t.strokeStyle="rgba(0,0,0,0.5)",t.lineWidth=2,t.arc(0,100,80,0,Math.PI/2,!0),t.stroke(),t.fillRect(0,20,2,30),t.fillRect(50,98,30,2),t.restore(),e.dual={offsetX:160,offsetY:100,width:200,height:60},t.save(),t.translate(160,100),t.beginPath(),t.moveTo(30,0),t.lineTo(170,0),t.lineTo(200,20),t.lineTo(200,40),t.lineTo(170,60),t.lineTo(30,60),t.lineTo(0,40),t.lineTo(0,20),t.closePath(),t.globalAlpha=.6,t.fillStyle="#FC7C69",t.fill(),t.lineWidth=6,t.strokeStyle="#FF2814",t.stroke(),t.globalAlpha=1,t.save(),t.restore(),t.fillStyle="white",t.strokeStyle="black",t.font="bold 35px Arial",t.fillText("Dual",55,30),t.lineWidth=2,t.strokeText("Dual",55,30),t.font="bold 55px Arial",t.lineWidth=3,t.fillText("Dual",40,50),t.strokeText("Dual",40,50),t.restore(),e.power={offsetX:370,offsetY:100,width:200,height:60},t.save(),t.translate(370,100),t.beginPath(),t.moveTo(30,0),t.lineTo(170,0),t.lineTo(200,20),t.lineTo(200,40),t.lineTo(170,60),t.lineTo(30,60),t.lineTo(0,40),t.lineTo(0,20),t.closePath(),t.fillStyle="#001BFF",t.globalAlpha=.5,t.fill(),t.lineWidth=6,t.strokeStyle="#001BFF",t.stroke(),t.globalAlpha=1,t.save(),t.restore(),t.fillStyle="white",t.strokeStyle="black",t.font="bold 43px Arial",t.lineWidth=3,t.fillText("Power",33,45),t.strokeText("Power",33,45),t.restore(),e.health={offsetX:570,offsetY:100,width:200,height:60},t.save(),t.translate(570,100),t.beginPath(),t.moveTo(30,0),t.lineTo(170,0),t.lineTo(200,20),t.lineTo(200,40),t.lineTo(170,60),t.lineTo(30,60),t.lineTo(0,40),t.lineTo(0,20),t.closePath(),t.globalAlpha=.6,t.fillStyle="red",t.fill(),t.lineWidth=6,t.strokeStyle="red",t.stroke(),t.globalAlpha=1,t.save(),t.restore(),t.fillStyle="white",t.strokeStyle="black",t.font="bold 43px Arial",t.lineWidth=3,t.fillText("Health",33,45),t.strokeText("Health",33,45),t.restore(),e.pointer_arrow={offsetX:0,offsetY:170,width:60,height:60},t.save(),t.translate(0,170),t.clearRect(0,0,60,60),t.beginPath(),t.lineWidth=3,t.fillStyle="red",t.moveTo(12,8),t.lineTo(48,8),t.lineTo(30,45),t.closePath(),t.fill(),t.stroke(),t.restore(),e.hot_terrain_bits={offsetX:0,offsetY:240,width:40,height:40},t.save(),t.fillStyle="#EB3725",t.lineWidth=3,t.translate(0,240),t.clearRect(0,0,40,40),t.beginPath(),t.moveTo(13,9),t.lineTo(7,17),t.lineTo(5,26),t.lineTo(12,32),t.lineTo(20,32),t.lineTo(26,36),t.lineTo(33,31),t.lineTo(32,19),t.lineTo(33,9),t.lineTo(24,8),t.closePath(),t.fill(),t.stroke(),t.restore(),e.snowy_terrain_bits={offsetX:50,offsetY:240,width:40,height:40},t.save(),t.fillStyle="#E8FFEE",t.lineWidth=3,t.translate(50,240),t.clearRect(0,0,40,40),t.beginPath(),t.moveTo(13,9),t.lineTo(7,17),t.lineTo(5,26),t.lineTo(12,32),t.lineTo(20,32),t.lineTo(26,36),t.lineTo(33,31),t.lineTo(32,19),t.lineTo(33,9),t.lineTo(24,8),t.closePath(),t.fill(),t.stroke(),t.restore(),e.lobby={main:new Audio("asset/lobby_long.mp3"),play:function(){this.main.volume=.21,this.main.play()}},e.lobby.main.addEventListener("ended",function(){this.currentTime=0,this.play()}),e}()}();